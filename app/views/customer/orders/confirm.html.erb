<div class="container">
  <!--注文情報確認のテーブル-->
  <div class="row">
    <table class="table">
      <thead>
        <tr>
          <th>商品名</th>
          <th>単価（税込）</th>
          <th>数量</th>
          <th>小計</th>
        </tr>
      </thead>
      <tbody>
        <% @carts.each do |cart| %>
        <tr>
          <td><%= cart.product.name %></td>
          <td><%= ((cart.product.tax_out_price).to_i * 1.1).round %></td>
          <td><%= cart.quantity %></td>
          <td><%= ((cart.product.tax_out_price).to_i * 1.1 * (cart.quantity).to_i).round %></td>
          <% @subtotal = ((cart.product.tax_out_price).to_i * 1.1 * (cart.quantity).to_i).round %>
          <% @total = @total + @subtotal %>
        </tr>
      <% end %>
      </tbody>
    </table>
  </div>

  <div class="row">
    <table class="table">
      <tr><th>送料</th><td><%= @order.shipping %></td></tr>
      <tr><th>商品合計</th><td><%= @total %></td></tr>
      <tr><th>請求金額</th><td><%= ((@order.shipping).to_i + (@total).to_i).round %></td></tr>
    </table>
  </div></br>

  <div class="row">
  <%= form_with model: @order, url: orders_path, method: :post, local: true do |f| %>
    <h4>支払方法</h4>
    <%= @order.payment %>
    <%= f.hidden_field :payment, value: @order.payment %>
    <h4>お届け先</h4>
    <%= @order.postal_code %> <%= @order.address %> <%= @order.name %>
    <%= f.hidden_field :postal_code, value: @order.postal_code %>
    <%= f.hidden_field :address, value: @order.address %>
    <%= f.hidden_field :name, value: @order.name %>
    <h3>ここより下がorder_productsパラメータ</h3>
    <% @carts.each do |cart| %>
      <%= f.fields_for :order_product do |op| %>
        <%= @kaime = @kaime + 1 %>回目
        <%= op.text_field :product_id, value: cart.product_id %>
        <%= op.text_field :quanity, value: cart.quantity %>
      <% end %><br>
    <% end %>
    <%= f.submit "購入を確定する" %>
  <% end %>
  </div>

</div>